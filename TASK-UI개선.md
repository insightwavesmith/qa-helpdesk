# TASK: 총가치각도기 UI 개선

## 목표
수강생이 각도기에서 자신의 광고 성과를 벤치마크와 직관적으로 비교할 수 있게 개선한다.

## 빌드/테스트
- `npm run build` 성공 필수
- 테스트 계정: smith.kim@inwv.co / test1234!
- 확인 URL: https://bscamp.vercel.app/protractor?account=1112351559994391

---

## U1. 지표별 프로그레스 바가 직관적이지 않음

### 현재 동작
- ThruPlay율이 기준 대비 103%인데 초록색 바가 77%만 채워져 있음
- 사용자 입장에서 "기준을 넘었는데 왜 바가 안 차지?" → 혼란

### 기대 동작
- 기준 대비 100% 이상이면 바가 꽉 참
- 기준 대비 70%면 바가 70%만 채워짐
- 기준값이 없으면 기존 점수 기반 폴백

### 참고
- TotalValueGauge.tsx에서 barW 계산이 score 기반으로 되어 있음
- pctOfBenchmark 값이 이미 API 응답에 포함되어 있으니 이걸 사용하면 됨

---

## U2. 파트별 점수를 등급으로 표시

### 현재 동작
- "기반점수 78점", "참여율 43점" 등 숫자로 표시
- 수강생은 78점이 좋은 건지 나쁜 건지 감이 안 옴

### 기대 동작
- 점수 대신 A/B/C 등급으로 표시
- 75점 이상 → A (우수, 초록)
- 50~74점 → B (보통, 노랑)
- 50점 미만 → C (미달, 빨강)
- 색상은 현재 scoreToStyle() 로직 그대로 유지
- 표시 예: "기반점수 A" "참여율 C"

### 참고
- TotalValueGauge.tsx, DiagnosticPanel.tsx 두 곳에서 점수 표시

---

## U3. 콘텐츠 탭에 벤치마크 비교값 추가

### 현재 동작
- 콘텐츠별 지표가 내 수치만 표시됨 (예: 3초시청률 26.81%)
- 이게 좋은 건지 나쁜 건지 비교 기준이 없음

### 기대 동작
- 각 지표 옆에 벤치마크 기준값도 함께 표시
- 예: "26.81% (기준 29.5%)" 또는 "26.81% / 기준 29.5%"
- pctOfBenchmark가 이미 있으니 역산 가능: 기준값 = 내 값 / (pct / 100)

### 하지 말 것
- 벤치마크 API를 별도 호출하지 말 것 (보안상 admin-only)
- 프론트에서 역산하면 됨

### 참고
- content-ranking.tsx에서 이미 pct_of_benchmark를 사용 중

---

## U4. "어제" 기간에서 T3 점수가 안 나오는 버그

### 현재 동작
- "어제" 기간 선택 시 성과 카드(총광고비, 클릭 등)는 표시됨
- 그런데 T3 점수는 "내일부터 확인 가능합니다" 표시
- 같은 daily_ad_insights 테이블 데이터인데 결과가 다름

### 기대 동작
- 어제 데이터가 있으면 T3 점수도 정상 표시
- 어제 데이터가 진짜 없으면 성과 카드도 빈 상태여야 함 (둘 다 같아야)

### 확인해볼 것
- insights API와 total-value API의 날짜 범위 계산 방식이 다른지
- UTC/KST 시간대 차이로 하루 밀리는지

---

## 실행 순서
U4(버그) → U1(바) → U2(등급) → U3(벤치마크)

## 하지 말 것
- 벤치마크 raw 수치를 새 API로 노출하지 말 것
- 기존 API 응답 구조를 깨뜨리지 말 것
- 다른 페이지(Q&A, 설정 등) 건드리지 말 것

---

## 리뷰 결과 (세션 104, 읽기 전용)

### U1. 프로그레스 바 — PASS (간단)
- barW = score → pctOfBenchmark으로 1줄 수정
- pctOfBenchmark null이면 score 폴백

### U2. 등급 표시 — PASS (간단)
- scoreToStyle()이 이미 75/50 임계값 사용 중
- 숫자→A/B/C 변환 헬퍼만 추가
- TotalValueGauge + DiagnosticPanel 2곳 수정

### U3. 콘텐츠 벤치마크 — PASS (주의사항 있음)
- 역산 가능하지만 pct_of_benchmark가 Math.round() 정수화 → ±0.5% 오차 발생
- 기준값 직접 노출이 "벤치마크 raw 수치 노출 금지" 정책에 저촉 가능 → Smith님 확인 필요

### U4. 어제 버그 — PASS (핵심 발견)
- **타임존 버그 패턴 발견**: `d.toISOString().split("T")[0]` → 로컬→UTC 변환으로 날짜 밀림
- 3곳: period-tabs.tsx:20, real-dashboard.tsx:34, t3-engine.ts:119
- KST 00:00~08:59 접속 시 "어제"가 "그저께"로 계산됨
- 단, insights와 total-value 둘 다 같은 dateRange 사용 → DB 데이터 존재 여부 선행 확인 필요

### 리뷰어 권장 실행 순서
U4(DB 확인 후 타임존 수정) → U1 → U2 → U3
