# ì•„í‚¤í…ì²˜ ë° ë°ì´í„° íë¦„

## ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì£¼ê°„ ë²¤ì¹˜ë§ˆí¬ (ì›”ìš”ì¼ 09:00 KST)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Meta API â†’ ad_insights_classified â†’ benchmarks (33ê°œ)          â”‚
â”‚  Mixpanel â†’ lp_benchmarks                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì¼ì¼ ìˆ˜ê°•ìƒ ìˆ˜ì§‘ (ë§¤ì¼ 01:00 KST)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Meta API â†’ daily_ad_performance (ì–´ì œ ë°ì´í„°)                   â”‚
â”‚  Mixpanel â†’ daily_lp_metrics (ì–´ì œ ë°ì´í„°)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ëŒ€ì‹œë³´ë“œ API (ìƒì‹œ)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  benchmarks + daily_* â†’ ìˆ˜ê°•ìƒ ì„±ê³¼ vs ë²¤ì¹˜ë§ˆí¬ ë¹„êµ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì£¼ìš” í…Œì´ë¸”

| í…Œì´ë¸” | ì„¤ëª… | í‚¤ |
|--------|------|-----|
| `ad_insights_classified` | ê´‘ê³  raw ë°ì´í„° | date, ad_id |
| `benchmarks` | ë²¤ì¹˜ë§ˆí¬ (33ê°œ ì¡°í•©) | date, creative_type, ranking_type, ranking_group |
| `lp_benchmarks` | LP ë²¤ì¹˜ë§ˆí¬ | date |
| `accounts` | ê³„ì • ì •ë³´ | account_id |
| `daily_ad_performance` | ì¼ì¼ ê´‘ê³  ì„±ê³¼ | date, ad_id |
| `daily_lp_metrics` | ì¼ì¼ LP ì§€í‘œ | date, account_id |

---

## ë²¤ì¹˜ë§ˆí¬ ê³„ì‚° ë°©ì‹ (V6)

| ranking_type | GROUP BY ê¸°ì¤€ | ê³„ì‚° ë°©ì‹ | ì„¤ëª… |
|-------------|---------------|----------|------|
| **quality** | quality_ranking | IQR 3.0Ã— í•„í„°ë§ í›„ **AVG** | ì´ìƒì¹˜ ì œê±° í›„ í‰ê·  |
| **engagement** | engagement_ranking | **MEDIAN (P50)** | ì¤‘ìœ„ê°’ |
| **conversion** | conversion_ranking | IQR 3.0Ã— í•„í„°ë§ í›„ **AVG** | ì´ìƒì¹˜ ì œê±° í›„ í‰ê·  |

### ë²¤ì¹˜ë§ˆí¬ êµ¬ì¡° (33ê°œ)
- **27ê°œ ì¡°í•©**: `creative_type(3) Ã— ranking_type(3) Ã— ranking_group(3)`
  - creative_type: VIDEO, IMAGE, CATALOG
  - ranking_type: quality, engagement, conversion
  - ranking_group: ABOVE_AVERAGE, AVERAGE, BELOW_AVERAGE
- **6ê°œ MEDIAN_ALL**: `creative_type(3) Ã— ranking_type(2)`
  - íŒì • ê¸°ì¤€ì„ ìš© ì „ì²´ ì¤‘ìœ„ê°’
  - engagement, conversionë§Œ (quality ì œì™¸)

---

## íŒì • ë¡œì§ (3-tier)

```javascript
// dashboard.html - get3LevelVerdict()
ðŸŸ¢ ìš°ìˆ˜: value >= ABOVE_AVERAGE
ðŸŸ¡ ë³´í†µ: value >= MEDIAN_ALL
ðŸ”´ ë¯¸ë‹¬: value < MEDIAN_ALL
```

---

## ì¤‘ë³µ ë°©ì§€ ë¡œì§

```python
# collect_benchmarks.py

# 1. 27ê°œ ê·¸ë£¹ ì‚­ì œ í›„ INSERT
DELETE FROM benchmarks
WHERE date = '{date_str}' AND ranking_group != 'MEDIAN_ALL'

# 2. 6ê°œ MEDIAN_ALL ì‚­ì œ í›„ INSERT
DELETE FROM benchmarks
WHERE date = '{date_str}' AND ranking_group = 'MEDIAN_ALL'
```

---

## LP ë²¤ì¹˜ë§ˆí¬ ì¡°ê±´

- **í’ˆì§ˆ ê¸°ì¤€**: 70%+ Above Average ê´‘ê³  ê³„ì •ë§Œ
- **ìµœì†Œ ìƒ˜í”Œ**: 2ê°œ ì´ìƒ Average ì´ìƒ ê´‘ê³ 
- **ìˆ˜ì§‘ ì£¼ê¸°**: ì£¼ê°„ (collect_benchmarks.py)

### LP ì§€í‘œ (V6)
- bounce_1s_rate, bounce_10s_rate (unique ê¸°ì¤€)
- avg_time_on_page
- scroll_25/50/75/100_rate
- review_click_rate
- lp_session_to_cart/checkout/purchase
- lp_checkout_to_purchase

---

## í™˜ê²½ë³€ìˆ˜

### .env íŒŒì¼
```env
META_ACCESS_TOKEN=EAAG...  # Meta Graph API í† í°
```

### ì½”ë“œì—ì„œ ë¡œë“œ
```python
load_dotenv(os.path.join(os.path.dirname(os.path.dirname(__file__)), '.env'))
META_ACCESS_TOKEN = os.environ.get("META_ACCESS_TOKEN")
```

---

## ì½”ë“œ íŒ¨í„´

### BigQuery ì ‘ê·¼
```python
from bq_client import get_bigquery_client, PROJECT_ID, DATASET_ID

client = get_bigquery_client()
query = f"SELECT * FROM `{PROJECT_ID}.{DATASET_ID}.í…Œì´ë¸”ëª…`"
```

### ë‚ ì§œ ì²˜ë¦¬
```python
from datetime import datetime, timedelta

# ì–´ì œ ë‚ ì§œ (ê¶Œìž¥)
date_str = (datetime.now() - timedelta(days=1)).strftime("%Y-%m-%d")
```
