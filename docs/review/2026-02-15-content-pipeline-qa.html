<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>콘텐츠 파이프라인 QA 리뷰 — 아키텍처 + 이슈 5건 + email_summary 구조 가이드</title>
  <meta property="og:title" content="콘텐츠 파이프라인 QA 리뷰">
  <meta property="og:description" content="콘텐츠 생성→검토→뉴스레터 파이프라인 아키텍처 분석, 이슈 5건 Before/After, email_summary 타입별 구조 가이드.">
  <meta property="og:type" content="article">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: true, theme: "base", themeVariables: { primaryColor: "#FEF2F2", primaryBorderColor: "#F75D5D", primaryTextColor: "#1a1a1a", lineColor: "#9ca3af", fontSize: "13px" } });</script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: "Pretendard", -apple-system, BlinkMacSystemFont, sans-serif; background: #fff; color: #1a1a1a; line-height: 1.7; padding: 40px 20px; max-width: 920px; margin: 0 auto; }
    h1 { font-size: 24px; font-weight: 800; margin-bottom: 8px; }
    h2 { font-size: 18px; font-weight: 700; margin: 36px 0 12px; padding-bottom: 8px; border-bottom: 2px solid #F75D5D; }
    h3 { font-size: 15px; font-weight: 700; margin: 20px 0 8px; color: #374151; }
    h4 { font-size: 14px; font-weight: 700; margin: 16px 0 6px; color: #1a1a1a; }
    p, li { font-size: 14px; color: #374151; }
    p { margin-bottom: 12px; }
    ul, ol { padding-left: 20px; margin-bottom: 12px; }
    li { margin-bottom: 4px; }
    .meta { font-size: 13px; color: #9ca3af; margin-bottom: 24px; }
    .meta span { margin-right: 16px; }
    .badge { display: inline-block; padding: 2px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
    .badge-ok { background: #DCFCE7; color: #166534; }
    .badge-warn { background: #FEF9C3; color: #854D0E; }
    .badge-danger { background: #FEE2E2; color: #991B1B; }
    .badge-info { background: #DBEAFE; color: #1E40AF; }
    .badge-purple { background: #F3E8FF; color: #6B21A8; }
    .summary-box { background: #FEF2F2; border-left: 4px solid #F75D5D; padding: 16px 20px; border-radius: 0 8px 8px 0; margin-bottom: 24px; }
    .summary-box strong { color: #F75D5D; }
    pre { background: #f8f9fc; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; overflow-x: auto; font-size: 13px; line-height: 1.6; margin-bottom: 16px; }
    code { font-family: "SF Mono", "Fira Code", monospace; font-size: 13px; }
    pre code { color: #374151; }
    p code, li code, td code { background: #f3f4f6; padding: 1px 6px; border-radius: 4px; color: #E54949; font-size: 12px; }
    .diff-add { color: #166534; background: #DCFCE7; }
    .diff-del { color: #991B1B; background: #FEE2E2; text-decoration: line-through; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 16px; font-size: 13px; }
    th, td { border: 1px solid #e5e7eb; padding: 10px 12px; text-align: left; }
    th { background: #FEF2F2; font-weight: 600; color: #6b7280; }
    .issue-card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
    .issue-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
    .issue-num { display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 8px; background: #F75D5D; color: #fff; font-size: 14px; font-weight: 800; flex-shrink: 0; }
    .issue-title { font-size: 15px; font-weight: 700; }
    .issue-meta { font-size: 12px; color: #9ca3af; margin-bottom: 12px; }
    .mermaid { margin: 16px 0 24px; }
    .guide-block { border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden; margin-bottom: 20px; }
    .guide-header { padding: 12px 16px; font-size: 14px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
    .guide-header.edu { background: #DBEAFE; color: #1E40AF; }
    .guide-header.notice { background: #FEF2F2; color: #991B1B; }
    .guide-header.case { background: #F3E8FF; color: #6B21A8; }
    .guide-body { padding: 16px; }
    .edge-case-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 8px; }
    @media (max-width: 700px) { .edge-case-grid { grid-template-columns: 1fr; } }
    .edge-pill { background: #f8f9fc; border: 1px solid #e5e7eb; border-radius: 6px; padding: 8px 10px; font-size: 12px; color: #374151; }
    footer { margin-top: 48px; padding-top: 16px; border-top: 1px solid #e5e7eb; font-size: 12px; color: #9ca3af; }
  </style>
</head>
<body>
  <h1>콘텐츠 파이프라인 QA 리뷰</h1>
  <p style="font-size:16px;font-weight:600;color:#F75D5D;margin-bottom:4px;">아키텍처 분석 + 이슈 5건 + email_summary 구조 가이드</p>
  <div class="meta">
    <span>리뷰일: 2026-02-15</span>
    <span>리뷰어: leader (에이전트)</span>
    <span>대상: 콘텐츠 생성→뉴스레터 전체 파이프라인</span>
    <span><span class="badge badge-info">사전 리뷰 (코드 수정 없음)</span></span>
  </div>

  <div class="summary-box">
    <strong>요약:</strong> 콘텐츠 파이프라인에서 <strong>5건의 구조적 이슈</strong>를 발견했습니다.<br>
    핵심: RAG 미연결, webinar↔notice 타입 불일치, email_summary에 배너 구조 미포함.
    수정 파일 3개(<code>contents.ts</code>, <code>email-template-utils.ts</code>, <code>new-content-modal.tsx</code>)로 해결 가능.
  </div>

  <!-- 1. 아키텍처 다이어그램 -->
  <h2>1. 파이프라인 아키텍처</h2>
  <p>콘텐츠 생성부터 뉴스레터 발송까지 3개 경로의 전체 데이터 흐름입니다. <span class="badge badge-danger">&#10005;</span> 표시는 현재 누락/단절 지점입니다.</p>

  <h3>1-1. 전체 흐름도</h3>
  <div class="mermaid">
flowchart TB
    subgraph UI["UI 레이어"]
        A["new-content-modal.tsx
type: education | case_study
| webinar | notice | promo"]
        N["newsletter-edit-panel.tsx
Unlayer + 발송"]
    end
    subgraph GEN["콘텐츠 생성 contents.ts"]
        B["generateContentWithAI
L623"]
        C["TYPE_PROMPTS
system + emailSummaryGuide"]
        D["CONTENT_BASE_STYLE
하드코딩 일반지식"]
        E["Claude API
claude-sonnet-4"]
    end
    subgraph RAG_P["RAG 파이프라인 rag.ts"]
        R1["searchRelevantChunks
L26"]
        R2["generateEmbedding
gemini.ts"]
        R3["match_lecture_chunks
Supabase RPC"]
        R4["generateRAGAnswer
L55"]
    end
    subgraph DB["데이터베이스"]
        DB1[("contents 테이블
title, body_md,
email_summary, type")]
        DB2[("lecture_chunks 테이블
임베딩 벡터")]
    end
    subgraph NL["뉴스레터 변환"]
        T1["buildDesignFromSummary
email-template-utils.ts L250"]
        T2["Template 선택
A=education B=notice
C=case_study"]
        T3["markdownToEmailHtml
BANNER_MAP 매칭"]
    end
    A -->|"topic + type"| B
    B --> C
    B --> D
    C --> E
    D --> E
    E -->|"title + bodyMd + emailSummary"| DB1
    DB1 -->|"email_summary"| N
    N --> T1
    T1 --> T2
    T2 --> T3
    R1 --> R2
    R2 --> R3
    R3 --> R1
    R1 --> R4
    B -.->|"미연결"| R1
    DB2 -.->|"콘텐츠 생성에 미사용"| R3
    style B fill:#FEE2E2,stroke:#991B1B
    style R1 fill:#DBEAFE,stroke:#1E40AF
    style T2 fill:#FEF9C3,stroke:#854D0E
  </div>

  <h3>1-2. 경로별 상태</h3>
  <table>
    <thead><tr><th>경로</th><th>시작점</th><th>처리</th><th>종료점</th><th>상태</th></tr></thead>
    <tbody>
      <tr><td><strong>생성</strong></td><td>new-content-modal<br><code>type</code> 선택</td><td><code>generateContentWithAI()</code><br>Claude API → 파싱</td><td><code>contents</code> DB</td><td><span class="badge badge-warn">부분 동작</span></td></tr>
      <tr><td><strong>뉴스레터</strong></td><td>newsletter-edit-panel<br><code>email_summary</code></td><td><code>buildDesignFromSummary()</code><br>템플릿 매핑 → 파서</td><td>Unlayer → 발송</td><td><span class="badge badge-warn">타입 불일치</span></td></tr>
      <tr><td><strong>RAG (Q&amp;A)</strong></td><td>질문 생성</td><td><code>searchRelevantChunks()</code><br><code>generateRAGAnswer()</code></td><td><code>answers</code> DB</td><td><span class="badge badge-ok">정상</span></td></tr>
      <tr><td><strong>RAG → 생성</strong></td><td>-</td><td>-</td><td>-</td><td><span class="badge badge-danger">미연결</span></td></tr>
    </tbody>
  </table>

  <h3>1-3. 타입 매핑 흐름 (불일치)</h3>
  <div class="mermaid">
flowchart LR
    UI_SEL["UI 선택
webinar"] -->|"type=webinar"| GEN_F["generateContentWithAI
TYPE_PROMPTS.webinar"]
    GEN_F -->|"DB 저장"| DB_C["contents.type = webinar"]
    DB_C -->|"뉴스레터"| BDS["buildDesignFromSummary"]
    BDS -->|"type === notice?"| CHK{"매칭?"}
    CHK -->|"webinar != notice"| DEF["DEFAULT_TEMPLATE
일반 템플릿"]
    CHK -->|"notice === notice"| TPB["TEMPLATE_B
웨비나 히어로"]
    style CHK fill:#FEF9C3,stroke:#854D0E
    style DEF fill:#FEE2E2,stroke:#991B1B
    style TPB fill:#DCFCE7,stroke:#166534
  </div>

  <!-- 2. 이슈 5건 분석 -->
  <h2>2. 이슈 분석 (5건)</h2>

  <!-- 이슈 1 -->
  <div class="issue-card">
    <div class="issue-header">
      <span class="issue-num">1</span>
      <span class="issue-title">RAG 미연결 — 콘텐츠 생성에 임베딩 지식 미반영</span>
      <span class="badge badge-danger">Critical</span>
    </div>
    <div class="issue-meta">파일: <code>src/actions/contents.ts</code> L623~698 | 영향: 생성된 모든 콘텐츠의 품질</div>
    <h4>현상</h4>
    <p><code>generateContentWithAI()</code>는 <code>CONTENT_BASE_STYLE</code>(하드코딩 일반지식)만 사용하고, <code>lecture_chunks</code> 테이블의 임베딩 데이터를 참조하지 않습니다. Q&amp;A의 <code>generateRAGAnswer()</code>는 RAG를 정상 사용 중.</p>
    <h4>Before / After</h4>
    <pre><code><span class="diff-del">// AS-IS (contents.ts L636~660)
// Claude API 호출 시 CONTENT_BASE_STYLE만 사용
body: JSON.stringify({
  model: "claude-sonnet-4-20250514",
  max_tokens: 8192,
  system: typePrompt.system,  // CONTENT_BASE_STYLE 포함
  messages: [{ role: "user", content: `${typePrompt.userPrefix}: ${topic}...` }],
}),</span>

<span class="diff-add">// TO-BE: RAG 컨텍스트 주입
import { searchRelevantChunks } from "@/lib/rag";

// 1. topic으로 관련 청크 검색
const chunks = await searchRelevantChunks(topic, 5, 0.4);
const ragContext = chunks.length > 0
  ? `\n\n## 강의 자료 참고 (RAG)\n${chunks.map(c =>
      `[${c.lecture_name} - ${c.week}]\n${c.content}`).join("\n\n")}`
  : "";

// 2. system 프롬프트에 RAG 컨텍스트 추가
system: typePrompt.system + ragContext,</span></code></pre>

    <h4>수정 계획</h4>
    <table>
      <tr><th>항목</th><th>상세</th></tr>
      <tr><td>수정 파일</td><td><code>src/actions/contents.ts</code> L636 부근</td></tr>
      <tr><td>추가 import</td><td><code>searchRelevantChunks</code> from <code>@/lib/rag</code></td></tr>
      <tr><td>검색 파라미터</td><td>limit=5, threshold=0.4 (Q&amp;A와 동일)</td></tr>
      <tr><td>주입 위치</td><td><code>typePrompt.system</code> 뒤에 append</td></tr>
      <tr><td>토큰 예산</td><td>RAG 청크 총 길이 &le; 3000자로 truncation</td></tr>
    </table>
    <h4>엣지 케이스</h4>
    <div class="edge-case-grid">
      <div class="edge-pill"><strong>E1</strong> lecture_chunks 빈 테이블 → chunks=[] → ragContext="" → 기존 동작과 동일</div>
      <div class="edge-pill"><strong>E2</strong> topic 한글+영어 혼합 → text-embedding-004 다국어 지원, 정상 검색</div>
      <div class="edge-pill"><strong>E3</strong> 검색 결과 총 텍스트 3000자 초과 → ragContext.slice(0, 3000) truncation</div>
      <div class="edge-pill"><strong>E4</strong> Gemini API 장애 → try-catch, RAG 없이 생성 진행</div>
    </div>
  </div>

  <!-- 이슈 2 -->
  <div class="issue-card">
    <div class="issue-header">
      <span class="issue-num">2</span>
      <span class="issue-title">타입 매핑 불일치 — UI "webinar" ≠ 템플릿 "notice"</span>
      <span class="badge badge-danger">Critical</span>
    </div>
    <div class="issue-meta">파일: <code>src/lib/email-template-utils.ts</code> L252~258 | 영향: webinar 뉴스레터 전부 잘못된 템플릿</div>
    <h4>현상</h4>
    <p>UI에서 "웨비나" 선택 → DB에 <code>type='webinar'</code> 저장. 그러나 <code>buildDesignFromSummary()</code>는 <code>'notice'</code>만 Template B로 매핑. <code>'webinar'</code>는 DEFAULT로 fall-through.</p>
    <h4>Before / After</h4>
    <pre><code><span class="diff-del">// AS-IS (email-template-utils.ts L252~258)
const baseTemplate =
  content.type === "notice"
    ? BS_CAMP_TEMPLATE_B
    : content.type === "case_study"
      ? BS_CAMP_TEMPLATE_C
      : content.type === "education"
        ? BS_CAMP_TEMPLATE_A
        : BS_CAMP_DEFAULT_TEMPLATE; // webinar가 여기로</span>

<span class="diff-add">// TO-BE: webinar도 Template B 적용
const baseTemplate =
  content.type === "notice" || content.type === "webinar"
    ? BS_CAMP_TEMPLATE_B
    : content.type === "case_study"
      ? BS_CAMP_TEMPLATE_C
      : content.type === "education"
        ? BS_CAMP_TEMPLATE_A
        : BS_CAMP_DEFAULT_TEMPLATE;</span></code></pre>

    <h4>수정 방안 비교</h4>
    <table>
      <tr><th>방안</th><th>장점</th><th>단점</th><th>추천</th></tr>
      <tr><td><strong>A. 템플릿 매핑 확장</strong></td><td>기존 데이터 호환, 1행 변경</td><td>webinar/notice 중복</td><td><span class="badge badge-ok">1차 적용</span></td></tr>
      <tr><td><strong>B. UI 타입 통합</strong></td><td>의미 명확, 장기 정리</td><td>DB 마이그레이션 필요</td><td>2차 정리</td></tr>
    </table>
    <h4>엣지 케이스</h4>
    <div class="edge-case-grid">
      <div class="edge-pill"><strong>E1</strong> 기존 webinar 타입 콘텐츠 → 즉시 Template B 적용 (호환)</div>
      <div class="edge-pill"><strong>E2</strong> promo 타입 → DEFAULT 유지 (영향 없음)</div>
      <div class="edge-pill"><strong>E3</strong> hero 블록 없는 콘텐츠 → findContentById null, hero 미표시 (무해)</div>
    </div>
  </div>

  <!-- 이슈 3 -->
  <div class="issue-card">
    <div class="issue-header">
      <span class="issue-num">3</span>
      <span class="issue-title">email_summary 구조 미인식 — BANNER_MAP 배너 헤딩 미포함</span>
      <span class="badge badge-warn">High</span>
    </div>
    <div class="issue-meta">파일: <code>src/actions/contents.ts</code> L576~580 | 영향: notice/webinar 배너 전부 gradient fallback</div>
    <h4>현상</h4>
    <p><code>emailSummaryGuide</code>에 <code>### 강의 미리보기</code> 등 BANNER_MAP 키가 없어, AI가 자유형 마크다운 생성 → h3 배너 매칭 실패.</p>
    <h4>Before / After</h4>
    <pre><code><span class="diff-del">// AS-IS (contents.ts L576~580)
emailSummaryGuide: `웨비나 이메일 요약:
- 일시 + 주제 명확히
- 어젠다 핵심 3~4개
- 참여 혜택 강조
- "지금 등록하기" CTA`,</span>

<span class="diff-add">// TO-BE: BANNER_MAP 키 기반 ### 구조 강제
emailSummaryGuide: `웨비나 이메일 요약을 아래 ### 구조로 정확히 작성하세요.
반드시 아래 4개 섹션을 사용 (변경 금지):

### 강의 미리보기
웨비나 핵심 내용 2~3문장 요약.

### 핵심 주제
✅ **주제1** — 설명
✅ **주제2** — 설명
✅ **주제3** — 설명

### 이런 분들을 위해
✅ 대상1
✅ 대상2
✅ 대상3

### 웨비나 일정
| 항목 | 내용 |
|------|------|
| 일시 | (날짜 시간) |
| 장소 | Zoom 라이브 |
| 참가비 | 무료 |`,</span></code></pre>

    <h4>education / case_study도 동일 패턴</h4>
    <pre><code><span class="diff-add">// education emailSummaryGuide 구조:
### INSIGHT → 핵심 인사이트
### KEY POINT → ✅ 포인트 (넘버카드)
### CHECKLIST → ✅ 체크리스트

// case_study emailSummaryGuide 구조:
### 성과 → 수치 하이라이트
### 핵심 변화 → Before/After
### INTERVIEW → 고객 인용문</span></code></pre>

    <h4>엣지 케이스</h4>
    <div class="edge-case-grid">
      <div class="edge-pill"><strong>E1</strong> AI가 ### 변형 ("웨비나에서 다루는 핵심 주제") → 부분매칭(T1)으로 해결</div>
      <div class="edge-pill"><strong>E2</strong> AI가 ### 헤딩 누락 → 해당 배너만 gradient, 나머지 정상</div>
      <div class="edge-pill"><strong>E3</strong> AI가 추가 ### 생성 → BANNER_MAP에 없으면 gradient (무해)</div>
      <div class="edge-pill"><strong>E4</strong> AI가 ## 사용 → 파서는 ### 만 배너 매칭, ## 은 h2 렌더링</div>
    </div>
  </div>

  <!-- 이슈 4 -->
  <div class="issue-card">
    <div class="issue-header">
      <span class="issue-num">4</span>
      <span class="issue-title">검토 단계 부재 — AI 생성 → 즉시 DB 저장</span>
      <span class="badge badge-warn">Medium</span>
    </div>
    <div class="issue-meta">파일: <code>src/components/content/new-content-modal.tsx</code> | 영향: UX — 미리 확인/수정 불가</div>
    <h4>현상</h4>
    <p><code>generateContentWithAI()</code> 결과가 바로 <code>createContent()</code>로 DB 저장. 검토/수정 기회 없음.</p>
    <h4>현재 vs 제안</h4>
    <div class="mermaid">
flowchart LR
    subgraph NOW["현재"]
        A1["topic 입력"] --> A2["generateContentWithAI"] --> A3["createContent"] --> A4["DB 저장"]
    end
    subgraph PROPOSED["제안"]
        B1["topic 입력"] --> B2["generateContentWithAI"] --> B3["미리보기 모달\ntitle + body\n+ email_summary\n수정 가능"]
        B3 -->|"승인"| B4["createContent"]
        B3 -->|"재생성"| B2
    end
    style A3 fill:#FEE2E2
    style B3 fill:#DCFCE7
    </div>
    <h4>수정 계획</h4>
    <table>
      <tr><th>단계</th><th>변경</th><th>파일</th></tr>
      <tr><td>1</td><td>결과를 state에 저장 (DB 아님)</td><td><code>new-content-modal.tsx</code></td></tr>
      <tr><td>2</td><td>미리보기 step 추가 (<code>step === "preview"</code>)</td><td><code>new-content-modal.tsx</code></td></tr>
      <tr><td>3</td><td>email_summary 편집 textarea</td><td><code>new-content-modal.tsx</code></td></tr>
      <tr><td>4</td><td>"승인" 시에만 createContent 호출</td><td><code>new-content-modal.tsx</code></td></tr>
    </table>
    <h4>엣지 케이스</h4>
    <div class="edge-case-grid">
      <div class="edge-pill"><strong>E1</strong> email_summary 빈 문자열 → 뉴스레터 본문 없음, 경고 필요</div>
      <div class="edge-pill"><strong>E2</strong> 재생성 반복 → API 과호출 방지: 쿨다운 3초</div>
      <div class="edge-pill"><strong>E3</strong> 탭 닫기 → beforeunload 미저장 경고</div>
    </div>
  </div>

  <!-- 이슈 5 -->
  <div class="issue-card">
    <div class="issue-header">
      <span class="issue-num">5</span>
      <span class="issue-title">TYPE_PROMPTS에 실제 웨비나 정보 없음</span>
      <span class="badge badge-info">Low (이슈 1 해결 시 자동 해소)</span>
    </div>
    <div class="issue-meta">파일: <code>src/actions/contents.ts</code> L501~517 + L560~574 | 영향: 콘텐츠 구체성</div>
    <h4>현상</h4>
    <p><code>CONTENT_BASE_STYLE</code>에는 일반 지식만. Smith님 실적(ROAS 450%), 자격, 커리큘럼, 웨비나 일정 등 구체 정보 없음.</p>
    <h4>해결 방향</h4>
    <table>
      <tr><th>방안</th><th>설명</th><th>우선순위</th></tr>
      <tr><td><strong>A. RAG 연결</strong></td><td>lecture_chunks에 실적 데이터 임베딩 → 자동 반영</td><td><span class="badge badge-ok">이슈 1과 동시 해결</span></td></tr>
      <tr><td><strong>B. 하드코딩 보강</strong></td><td>스미스 프로필, 성과 수치 추가</td><td>즉시 가능 (임시)</td></tr>
      <tr><td><strong>C. 동적 컨텍스트</strong></td><td>DB에서 최근 case_study 성과 쿼리</td><td>장기 과제</td></tr>
    </table>
    <h4>엣지 케이스</h4>
    <div class="edge-case-grid">
      <div class="edge-pill"><strong>E1</strong> lecture_chunks에 웨비나 데이터 없음 → CONTENT_BASE_STYLE만 사용</div>
      <div class="edge-pill"><strong>E2</strong> RAG 데이터 오래됨 (2024) → 최신성 관리 필요</div>
      <div class="edge-pill"><strong>E3</strong> RAG + 하드코딩 충돌 → "RAG 데이터 우선" 지시 추가</div>
    </div>
  </div>

  <!-- 3. email_summary 타입별 구조 가이드 -->
  <h2>3. email_summary 타입별 구조 가이드</h2>
  <p>AI가 생성해야 하는 <code>email_summary</code> 마크다운의 타입별 필수 구조. <code>###</code> 헤딩은 BANNER_MAP 키와 일치하거나 키를 포함(부분매칭)해야 합니다.</p>

  <!-- education -->
  <div class="guide-block">
    <div class="guide-header edu">
      <span class="badge badge-info">education</span> 교육 콘텐츠 — Template A
    </div>
    <div class="guide-body">
      <h4>필수 배너 헤딩</h4>
      <table>
        <tr><th>### 헤딩</th><th>BANNER_MAP 키</th><th>파일</th><th>설명</th></tr>
        <tr><td><code>### INSIGHT</code></td><td>INSIGHT</td><td>banner-insight.png</td><td>핵심 인사이트</td></tr>
        <tr><td><code>### KEY POINT</code></td><td>KEY POINT</td><td>banner-key-point.png</td><td>요약 포인트</td></tr>
        <tr><td><code>### CHECKLIST</code></td><td>CHECKLIST</td><td>banner-checklist.png</td><td>실행 체크리스트</td></tr>
      </table>
      <h4>마크다운 구조 예시</h4>
      <pre><code>메타 광고 성과를 극대화하는 3가지 핵심 전략을 정리했어요.

### INSIGHT

어드밴티지+ 쇼핑 캠페인(ASC)은 AI가 타겟팅부터 소재 최적화까지
자동으로 처리해요. 2025년 기준 ASC를 활용한 광고주의 평균 ROAS는
기존 대비 **32% 향상**되었어요.

---

### KEY POINT

✅ **CBO + 넓은 타겟** — AI에게 최적화 여지를 넓혀주는 것이 핵심
✅ **소재 다양성** — 광고세트당 3~5개 소재, 2~3주 리프레시
✅ **픽셀 + CAPI 병행** — 데이터 정확도 95% 이상 확보

---

### CHECKLIST

✅ 어드밴티지+ 쇼핑 캠페인 세팅 완료
✅ 전환 API(CAPI) 연동 확인
✅ 소재 3개 이상 준비 (이미지 + 동영상 혼합)
✅ 맞춤 전환 이벤트 설정 (구매, 장바구니 등)</code></pre>
    </div>
  </div>

  <!-- notice/webinar -->
  <div class="guide-block">
    <div class="guide-header notice">
      <span class="badge badge-danger">notice / webinar</span> 웨비나 안내 — Template B (히어로)
    </div>
    <div class="guide-body">
      <h4>필수 배너 헤딩</h4>
      <table>
        <tr><th>### 헤딩 (AI 생성 가능 범위)</th><th>BANNER_MAP 키</th><th>파일</th><th>설명</th></tr>
        <tr><td><code>### 강의 미리보기</code> 또는 <code>### 강의 미리보기 세션</code></td><td>강의 미리보기</td><td>banner-preview.png</td><td>내용 요약</td></tr>
        <tr><td><code>### 핵심 주제</code> 또는 <code>### 웨비나에서 다루는 핵심 주제</code></td><td>핵심 주제</td><td>banner-topics.png</td><td>어젠다 넘버카드</td></tr>
        <tr><td><code>### 이런 분들을 위해</code> 또는 <code>### 이런 분들을 위해 준비했어요</code></td><td>이런 분들을 위해</td><td>banner-target.png</td><td>대상 체크리스트</td></tr>
        <tr><td><code>### 웨비나 일정</code> 또는 <code>### 웨비나 일정 안내</code></td><td>웨비나 일정</td><td>banner-schedule.png</td><td>일정 테이블</td></tr>
      </table>
      <h4>마크다운 구조 예시</h4>
      <pre><code>메타 광고 성과를 2배로 끌어올리는 실전 전략 웨비나를 준비했어요.

### 강의 미리보기

이번 웨비나에서는 2025년 메타 광고 알고리즘 변화와
실제 캠페인 데이터를 기반으로 최적화 전략을 공유해요.

---

### 핵심 주제

✅ **안드로메다 알고리즘 실전 활용법** — AI 매칭의 원리와 최적화 포인트
✅ **ASC 캠페인 세팅 완전 가이드** — 소재 구성부터 예산 설정까지
✅ **ROAS 200% 달성 케이스 분석** — 실제 자사몰 운영 데이터 공개

---

### 이런 분들을 위해 준비했어요

✅ 메타 광고 성과가 정체된 자사몰 운영자
✅ ROAS 개선이 시급한 마케터
✅ 어드밴티지+ 캠페인을 처음 시작하는 대표님

---

### 웨비나 일정 안내

| 항목 | 내용 |
|------|------|
| 일시 | 2026년 2월 20일 (목) 오후 8시 |
| 장소 | Zoom 라이브 (링크 별도 안내) |
| 참가비 | **무료** |
| 강사 | 스미스 (자사몰사관학교 대표) |</code></pre>
    </div>
  </div>

  <!-- case_study -->
  <div class="guide-block">
    <div class="guide-header case">
      <span class="badge badge-purple">case_study</span> 고객 성공사례 — Template C
    </div>
    <div class="guide-body">
      <h4>필수 배너 헤딩</h4>
      <table>
        <tr><th>### 헤딩</th><th>BANNER_MAP 키</th><th>파일</th><th>설명</th></tr>
        <tr><td><code>### 성과</code></td><td>성과</td><td>banner-results.png</td><td>수치 하이라이트</td></tr>
        <tr><td><code>### INTERVIEW</code></td><td>INTERVIEW</td><td>banner-interview.png</td><td>고객 인터뷰</td></tr>
        <tr><td><code>### 핵심 변화</code></td><td>핵심 변화</td><td>banner-change.png</td><td>Before→After</td></tr>
      </table>
      <h4>마크다운 구조 예시</h4>
      <pre><code>자사몰 A 대표님이 3개월 만에 ROAS 450%를 달성한 비결을 공유해요.

### 성과

#### Before
- 월 광고비 300만원, ROAS **120%** (적자)
- 타겟팅: 관심사 기반 수동 설정

#### After
- 월 광고비 300만원, ROAS **450%** (흑자 전환)
- 월 매출 **3배 성장** (1,200만원 → 3,600만원)

---

### 핵심 변화

✅ **CBO 전환** — 수동 예산 → AI 자동 분배로 효율 극대화
✅ **CAPI 연동** — 데이터 정확도 60% → 95%
✅ **소재 다양화** — 단일 이미지 → 동영상+카루셀 혼합

---

### INTERVIEW

> "처음에는 AI한테 예산을 맡기는 게 불안했는데,
> 2주 만에 ROAS가 2배로 뛰었어요."
>
> — A 대표님, 뷰티 자사몰 운영</code></pre>
    </div>
  </div>

  <!-- 4. BANNER_MAP 총정리 -->
  <h2>4. BANNER_MAP 매핑 총정리</h2>
  <table>
    <thead><tr><th>콘텐츠 타입</th><th>BANNER_MAP 키</th><th>파일명</th><th>매칭 방식</th><th>상태</th></tr></thead>
    <tbody>
      <tr><td rowspan="4">education</td><td>INSIGHT</td><td>banner-insight.png</td><td>정확/부분</td><td><span class="badge badge-ok">정상</span></td></tr>
      <tr><td>INSIGHT 01~03</td><td>banner-insight-01~03.png</td><td>긴 키 우선</td><td><span class="badge badge-ok">정상</span></td></tr>
      <tr><td>KEY POINT</td><td>banner-key-point.png</td><td>정확/부분</td><td><span class="badge badge-ok">정상</span></td></tr>
      <tr><td>CHECKLIST</td><td>banner-checklist.png</td><td>정확/부분</td><td><span class="badge badge-ok">정상</span></td></tr>
      <tr><td rowspan="4">notice / webinar</td><td>강의 미리보기</td><td>banner-preview.png</td><td>부분매칭</td><td><span class="badge badge-warn">Guide 수정 필요</span></td></tr>
      <tr><td>핵심 주제</td><td>banner-topics.png</td><td>부분매칭</td><td><span class="badge badge-warn">Guide 수정 필요</span></td></tr>
      <tr><td>이런 분들을 위해</td><td>banner-target.png</td><td>부분매칭</td><td><span class="badge badge-warn">Guide 수정 필요</span></td></tr>
      <tr><td>웨비나 일정</td><td>banner-schedule.png</td><td>부분매칭</td><td><span class="badge badge-warn">Guide 수정 필요</span></td></tr>
      <tr><td rowspan="3">case_study</td><td>INTERVIEW</td><td>banner-interview.png</td><td>정확/부분</td><td><span class="badge badge-ok">정상</span></td></tr>
      <tr><td>핵심 변화</td><td>banner-change.png</td><td>부분매칭</td><td><span class="badge badge-ok">정상</span></td></tr>
      <tr><td>성과</td><td>banner-results.png</td><td>부분매칭</td><td><span class="badge badge-warn">짧은 키 주의</span></td></tr>
    </tbody>
  </table>

  <!-- 5. 수정 우선순위 -->
  <h2>5. 수정 우선순위</h2>
  <table>
    <thead><tr><th>순위</th><th>이슈</th><th>파일</th><th>난이도</th><th>영향도</th></tr></thead>
    <tbody>
      <tr><td><strong>P0</strong></td><td>#2 타입 매핑 + #3 emailSummaryGuide</td><td><code>email-template-utils.ts</code> 1행 + <code>contents.ts</code> ~30행</td><td><span class="badge badge-ok">낮음</span></td><td><span class="badge badge-danger">Critical</span></td></tr>
      <tr><td><strong>P1</strong></td><td>#1 RAG 연결</td><td><code>contents.ts</code> ~15행</td><td><span class="badge badge-warn">중간</span></td><td><span class="badge badge-danger">Critical</span></td></tr>
      <tr><td><strong>P2</strong></td><td>#4 검토 단계</td><td><code>new-content-modal.tsx</code> ~50행</td><td><span class="badge badge-warn">중간</span></td><td><span class="badge badge-warn">High</span></td></tr>
      <tr><td><strong>P3</strong></td><td>#5 프롬프트 보강</td><td><code>contents.ts</code></td><td><span class="badge badge-ok">낮음</span></td><td><span class="badge badge-info">Low</span></td></tr>
    </tbody>
  </table>

  <!-- 6. 엣지 케이스 종합 -->
  <h2>6. 엣지 케이스 종합</h2>
  <table>
    <thead><tr><th>#</th><th>시나리오</th><th>현재 동작</th><th>기대 동작</th><th>관련 이슈</th></tr></thead>
    <tbody>
      <tr><td>1</td><td>lecture_chunks 빈 테이블</td><td>RAG 미연결로 무관</td><td>fallback: 하드코딩만 + 로그</td><td>#1</td></tr>
      <tr><td>2</td><td>한글+영어 혼합 topic</td><td>그대로 Claude 전달</td><td>Gemini 다국어 임베딩으로 검색</td><td>#1</td></tr>
      <tr><td>3</td><td>BANNER_MAP 외 ### 헤딩</td><td>gradient fallback</td><td>AI에게 키만 사용 강제</td><td>#3</td></tr>
      <tr><td>4</td><td>기존 webinar 타입 다수</td><td>DEFAULT 템플릿</td><td>Template B 자동 적용</td><td>#2</td></tr>
      <tr><td>5</td><td>RAG 토큰 예산 초과</td><td>고려 안 됨</td><td>3000자 truncation</td><td>#1</td></tr>
      <tr><td>6</td><td>동일 topic 중복 생성</td><td>중복 저장 허용</td><td>미리보기에서 유사 콘텐츠 경고</td><td>#4</td></tr>
    </tbody>
  </table>

  <footer>
    <p>QA Helpdesk 프로젝트 — 콘텐츠 파이프라인 QA 리뷰 | 2026-02-15 | 리뷰어: leader 에이전트 | 코드 수정: 없음</p>
  </footer>
</body>
</html>
