# 인증 및 RLS 정책 계획서

## 1. 개요
- 기능 설명: Supabase Auth를 활용한 사용자 인증, 프로필 관리, 역할 기반 접근 제어(RBAC), Row Level Security(RLS) 정책 구현
- 해결하려는 문제: 
  - 교육 수강생의 체계적인 가입/승인 프로세스 부재
  - 미승인 사용자의 무분별한 서비스 이용
  - 데이터 접근 권한의 세밀한 제어 필요

## 2. 핵심 요구사항

### 기능적 요구사항
- FR-01: 사용자는 이메일로 회원가입할 수 있어야 한다
- FR-02: 회원가입 시 사업자 정보(상호명, 사업자등록번호, 사업자등록증)를 제출해야 한다
- FR-03: 관리자는 신규 가입자를 승인/거절할 수 있어야 한다
- FR-04: 승인된 사용자만 서비스 핵심 기능에 접근할 수 있어야 한다
- FR-05: 관리자는 모든 데이터에 접근할 수 있어야 한다
- FR-06: 사용자는 본인이 작성한 콘텐츠를 수정/삭제할 수 있어야 한다
- FR-07: RLS 정책을 통해 데이터 접근 권한을 자동 제어해야 한다

### 비기능적 요구사항
- 성능: 인증 확인 응답시간 < 200ms
- 보안: RLS 정책 누락으로 인한 데이터 유출 방지
- 확장성: 신규 테이블 추가 시 일관된 RLS 정책 적용

## 3. 용어 정의

| 용어 | 영문 | 설명 |
|------|------|------|
| 프로필 | Profile | 사용자의 기본 정보 및 사업자 정보를 포함한 확장 정보 |
| 역할 | Role | 사용자의 권한 수준 (pending/approved/admin/rejected) |
| RLS | Row Level Security | PostgreSQL의 행 단위 보안 정책 |
| 승인 사용자 | Approved User | role이 'approved' 또는 'admin'인 사용자 |
| 서비스 클라이언트 | Service Client | RLS를 우회할 수 있는 관리자용 Supabase 클라이언트 |

## 4. 범위

### 포함
- Supabase Auth 기반 이메일 인증
- 사용자 프로필 생성 및 관리
- 관리자 승인/거절 워크플로우
- 모든 주요 테이블에 대한 RLS 정책 적용
- 역할 기반 데이터 접근 제어
- 사업자등록증 이미지 업로드 (Supabase Storage)

### 제외
- 소셜 로그인 (Google, Kakao 등)
- 2단계 인증 (2FA)
- 비밀번호 복잡성 정책 세부 설정
- 사용자 활동 로깅 (audit log)

## 5. 성공 기준

- [ ] 신규 가입자가 사업자 정보를 포함하여 회원가입할 수 있다
- [ ] 관리자가 pending 상태의 사용자를 승인/거절할 수 있다
- [ ] approved/admin 역할의 사용자만 질문/답변 등 핵심 기능에 접근할 수 있다
- [ ] 사용자는 본인이 작성한 데이터만 수정/삭제할 수 있다
- [ ] 관리자는 모든 데이터에 접근할 수 있다
- [ ] RLS 정책이 모든 테이블에 일관되게 적용되어 있다
- [ ] 인증되지 않은 사용자는 어떤 데이터도 조회할 수 없다
- [ ] 사업자등록증 이미지가 안전하게 저장되고 조회된다